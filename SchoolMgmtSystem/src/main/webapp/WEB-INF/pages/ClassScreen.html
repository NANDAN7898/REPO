<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="~{/layout}" >
<head>
<meta charset="ISO-8859-1">
<title>Add New Class</title>
<style type="text/css">
.center
{
	top:10%;
	transform:translatez(50%); 
}
.input-col
{
	margin-top: 10px;
}
.modal-body
{
	padding: 0px 0px;
}
.modal-header .close
{
	padding: 0px;
}
.alert
{
	padding: 10px;
	margin-bottom: 5px;
}
</style>
<script type="text/javascript" th:inline="javascript">
function fnSubmit()
{
	var form = document.ClassFormBean;
	var message = '';
	
	var classname = $("#className").val();
	var maxstudent = $("#maxStudent").val();
	var noofsection = $("#noOfSection").val();
	
	if(classname == null || classname.trim() == '')
	{
		message = /*[[${@environment.getProperty('webproto.schoolmgmt.label.classname')}]]*/;
		message += ' ';
		alert(message + /*[[${@environment.getProperty('webproto.schoolmgmt.validation.msg.requiredinformation')}]]*/);
		$("#className").focus();
		return false;
	}
	
	if(maxstudent == null || maxstudent.trim() == '')
	{
		message = /*[[${@environment.getProperty('webproto.schoolmgmt.label.maxstudent')}]]*/;
		message += ' ';
		alert(message + /*[[${@environment.getProperty('webproto.schoolmgmt.validation.msg.requiredinformation')}]]*/);
		$("#maxStudent").focus();
		return false;
	}
	
	if(isNaN(maxstudent))
	{
		message = /*[[${@environment.getProperty('webproto.schoolmgmt.label.maxstudent')}]]*/;
		message += ' ';
		alert(message + /*[[${@environment.getProperty('webproto.schoolmgmt.validation.msg.number')}]]*/);
		$("#maxStudent").focus();
		return false;
	}
	
	if(!isInt(maxstudent))
	{
		message = /*[[${@environment.getProperty('webproto.schoolmgmt.label.maxstudent')}]]*/;
		message += ' ';
		alert(message + /*[[${@environment.getProperty('webproto.schoolmgmt.validation.msg.digit')}]]*/);
		$("#maxStudent").focus();
		return false;
	}
	
	if(noofsection == null || noofsection.trim() == '')
	{
		message = /*[[${@environment.getProperty('webproto.schoolmgmt.label.noofsection')}]]*/;
		message += ' ';
		alert(message + /*[[${@environment.getProperty('webproto.schoolmgmt.validation.msg.requiredinformation')}]]*/);
		$("#noOfSection").focus();
		return false;
	}
	
	if(isNaN(noofsection))
	{
		message = /*[[${@environment.getProperty('webproto.schoolmgmt.label.noofsection')}]]*/;
		message += ' ';
		alert(message + /*[[${@environment.getProperty('webproto.schoolmgmt.validation.msg.number')}]]*/);
		$("#noOfSection").focus();
		return false;
	}
	
	if(!isInt(noofsection))
	{
		message = /*[[${@environment.getProperty('webproto.schoolmgmt.label.noofsection')}]]*/;
		message += ' ';
		alert(message + /*[[${@environment.getProperty('webproto.schoolmgmt.validation.msg.digit')}]]*/);
		$("#noOfSection").focus();
		return false;
	}
	
	if(parseInt(noofsection) > 5)
	{
		message = /*[[${@environment.getProperty('webproto.schoolmgmt.label.noofsection')}]]*/;
		message += ' should be less than 5';
		alert(message);
		$("#noOfSection").focus();
		return false;
	}
	
	if($("#actionType").val() == "UPDATE")
	{
		form.action = /*[[@{/class/update}]]*/;
	}
	else
	{
		form.action = /*[[@{/class/save}]]*/;
	}
	
	form.submit();
}

function fnReset()
{
	$("#className").val('');
	$("#maxStudent").val('');
	$("#noOfSection").val('');
}

function fnEdit(id)
{
	var token = /*[[${_csrf.token}]]*/;
	$.ajax({
        type: "POST",
        url: /*[[@{/class/getById}]]*/,
        data: {
        	"id"   : id
        }, 
        beforeSend: function(xhr) 
	    {
	        xhr.setRequestHeader('X-CSRF-TOKEN', token);
	    },
        cache: false,
        timeout: 600000,
        success: function (response)
        {	
        	var json = JSON.parse(response);
        	
        	Object.entries(json).forEach(([key, val]) => 
    		{
	        	$("#" + key).val(val);
    		});
        	$("#actionType").val("UPDATE");
        	openModal('classModal');
        },
        error: function (e) 
        {
            console.log("ERROR : ", e);
        }
    });
}

function fnDelete(id)
{
	var form = document.ClassFormBean;
	var urlStr = /*[[@{/class/deleteById}]]*/;
	urlStr += "?i=" + id;
	form.action = urlStr;
	form.submit();
}
</script>
</head>
<body>
<div layout:fragment="content" class="wrapper">
<form method="post" name="ClassFormBean" th:object="${ClassFormBean}">
<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
<input type="hidden" name="actionType" id="actionType" value=""/>
<input type="hidden" th:field="*{id}"/>
	<div class="col-lg-12 breadcrum_margin">
        <ol class="breadcrumb" style="margin: 0 -11px 15px 5px;">
          <li><i class="icon_house_alt"></i><a th:href="@{/admin}"><span th:text="${@environment.getProperty('webproto.schoolmgmt.label.home')}"></span></a></li>
          <li><i class="fas fa-users"></i><span th:text="${@environment.getProperty('webproto.schoolmgmt.label.student.class')}"></span></li>
        </ol>
    </div>
	<div class="row" style="margin-left: 5px;">
		<div class="col-lg-12">
			<div class="col-lg-2"></div>
			<div class="col-lg-8">
				<div class="alert alert-success alert-dismissible" th:if="${isAdded == true}">
					<button type="button" class="close" data-dismiss="alert">&times;</button>
					<span th:text="${@environment.getProperty('webproto.schoolmgmt.label.student.class')}"></span>&nbsp;<span th:text="${className}"></span>&nbsp;<span th:text="${@environment.getProperty('webproto.schoolmgmt.label.addedsuccessfully')}"></span>
				</div>
				<div class="alert alert-success alert-dismissible" th:if="${isDelete == true}">
					<button type="button" class="close" data-dismiss="alert">&times;</button>
					<span th:text="${@environment.getProperty('webproto.schoolmgmt.label.deletionsuccessfull')}"></span>
				</div>
				<div class="alert alert-success alert-dismissible" th:if="${isUpdated == true}">
					<button type="button" class="close" data-dismiss="alert">&times;</button>
					<span th:text="${@environment.getProperty('webproto.schoolmgmt.label.student.class')}"></span>&nbsp;<span th:text="${className}"></span>&nbsp;<span th:text="${@environment.getProperty('webproto.schoolmgmt.label.updatedsuccessfully')}"></span>
				</div>
			</div>
			<div class="col-lg-2">
				<span class="btn btn-primary text-bold" style="float: right; margin-right: -12px; margin-bottom: 5px; padding: 10px;" onclick="openModal('classModal');" th:text="${@environment.getProperty('webproto.schoolmgmt.label.addnew')}"></span>
			</div>
		</div>
		<div class="col-lg-12">
			<div class="modal classModal">
				<div class="modal-dialog center">
					<div class="modal-content">
						<div class="modal-header" style="height: 45px;">
							<span class="modal-title text-bold" style="margin-top: 4px;" th:text="${@environment.getProperty('webproto.schoolmgmt.label.addnew')}"></span>
							<span class="close text-bold" onclick="hideModal('classModal');" style="margin-top: -2px; margin-right: 0px; float: right;">&times;</span>
						</div>
						<div class="modal-body">
							<div class="input-col">
								<div class="col-lg-6">
									<label class="control-label" th:text="${@environment.getProperty('webproto.schoolmgmt.label.classname')}"></label>
								</div>
								<div class="col-lg-6">
									<input type="text" class="form-control" th:field="*{className}" maxlength="20">
								</div>
							</div>
							<div class="input-col">
								<div class="col-lg-6 input-col">
									<label class="control-label" th:text="${@environment.getProperty('webproto.schoolmgmt.label.maxstudent')}"></label>
								</div>
								<div class="col-lg-6 input-col">
									<input type="text" class="form-control" th:field="*{maxStudent}" maxlength="4">
								</div>
							</div>
							<div class="input-col">
								<div class="col-lg-6 input-col">
									<label class="control-label" th:text="${@environment.getProperty('webproto.schoolmgmt.label.noofsection')}"></label>
								</div>
								<div class="col-lg-6 input-col" style="margin-bottom: 10px;">
									<input type="text" class="form-control" th:field="*{noOfSection}" maxlength="2">
								</div>
							</div>
						</div>
						<div class="modal-footer">
					        <input type="button" class="btn btn-primary" onclick="fnReset()" th:value="${@environment.getProperty('webproto.schoolmgmt.label.reset')}"/>
							<input type="button" class="btn btn-primary" onclick="fnSubmit()" style="margin-left: 10px; width: 75px;" th:value="${@environment.getProperty('webproto.schoolmgmt.label.save')}"/>
					    </div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row input-col" style="margin-left: 5px;">
		<div class="col-sm-12">
			<section class="panel">
				<table class="table table-striped table-advance table-hover table-bordered">
					<tbody>
						<tr>
							<th style="width: 15%;">Class Code</th>
							<th class="text" style="width: 42%;" th:text="${@environment.getProperty('webproto.schoolmgmt.label.classname')}"></th>
							<th class="numeric" style="width: 17%;" th:text="${@environment.getProperty('webproto.schoolmgmt.label.noofsection')}"></th>
							<th class="numeric" style="width: 17%;" th:text="${@environment.getProperty('webproto.schoolmgmt.label.maxstudent')}"></th>
							<th style="text-align: center; width: 9%;" th:text="${@environment.getProperty('webproto.schoolmgmt.label.action')}"></th>
						</tr>
						<th:block th:each="clazz : ${classList}">
							<tr>
								<td style="width: 15%;">
									<span th:text="${clazz.id}"></span>
								</td>
								<td class="text" style="width: 42%;">
									<span th:text="${clazz.className}"></span>
								</td>
								<td class="numeric" style="width: 17%;">
									<span th:text="${clazz.noOfSection}"></span>
								</td>
								<td class="numeric" style="width: 17%;">
									<span th:text="${clazz.maxStudent}"></span>
								</td>
								<td style="text-align: center; width: 9%;">
									<span class="link" style="margin-right: 6px;" th:onclick="'fnEdit(\'' + ${clazz.id} + '\')'"><i class="fas fa-edit"></i></span>
									<span class="link" style="margin-left: 6px;" th:onclick="'fnDelete(\'' + ${clazz.id} + '\')'"><i class="fas fa-trash"></i></span>
								</td>
							</tr>
						</th:block>
					</tbody>
				</table>
			</section>
		</div>
	</div>
</form>
</div>
</body>
</html>